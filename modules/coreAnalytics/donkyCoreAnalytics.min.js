/*!
 * DonkCoreAnalytics JavaScript Library
 *
 * Copyright (C) Donky Networks Ltd. All rights reserved.
 *
 */
(function(){var a=function(d){if(d===undefined){throw new Error("Missing donkyCore")}var b;var c=30;var f={formatDate:function(h){var g=new Date(h);g.setMilliseconds(0);return g.toISOString()},setCookie:function(h,j,k){var i=new Date();i.setTime(i.getTime()+(k*60*1000));var g="expires="+i.toUTCString();document.cookie=h+"="+j+"; "+g},getCookie:function(j){var h=j+"=";var g=document.cookie.split(";");for(var k=0;k<g.length;k++){var l=g[k];while(l.charAt(0)==" "){l=l.substring(1)}if(l.indexOf(h)!=-1){return l.substring(h.length,l.length)}}return null}};function e(){console.log("Constructing DonkyCoreAnalytics");d.subscribeToLocalEvent("DonkyInitialised",function(g){b.analyse()});$(window).unload(function(){d.donkyData.set("SessionEndTime",new Date().valueOf())})}e.prototype={analyse:function(){if(window.location.protocol!="file:"){var i=f.getCookie("appLaunch");if(i==null){var k=0;f.setCookie("appLaunch","yes",c);d.donkyLogging.debugLog("new session");var h=d.donkyData.get("SessionStartTime");var l=d.donkyData.get("SessionEndTime");if(h!=null){var j={Type:"AppSession",startTimeUtc:f.formatDate(h),endTimeUtc:f.formatDate(l),operatingSystem:"Web",sessionTrigger:"None"};d.queueClientNotifications(j);k++;d.donkyData.set("SessionStartTime",new Date().valueOf())}else{d.donkyData.set("SessionStartTime",new Date().valueOf())}var g={Type:"AppLaunch",launchTimeUtc:f.formatDate(new Date().valueOf()),operatingSystem:"Web",sessionTrigger:"None"};d.queueClientNotifications(g);k++;if(k>0){d.donkyNetwork.synchronise()}}else{d.donkyLogging.debugLog("existing session");f.setCookie("appLaunch","yes",c)}}}};b=new e();return b};if(typeof define==="function"&&define.amd){define("donkyCoreAnalytics",["donkyCore"],function(b){return a(b)})}else{window.donkyCoreAnalytics=a(window.donkyCore)}}());